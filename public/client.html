<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Access Point Chat</title>
<style>
body {
  background: #0b0f14;
  color: #eee;
  font-family: system-ui;
}
#chat {
  height: 300px;
  overflow-y: auto;
  border: 1px solid #333;
  padding: 10px;
}
input, button {
  background: #121826;
  color: white;
  border: 1px solid #333;
  padding: 6px;
}
</style>
</head>
<body>

<h2>Access Point Chat</h2>

<div id="login">
  <input id="username" placeholder="Username">
  <button onclick="login()">Login</button>
</div>

<div id="app" style="display:none;">
  <div id="chat"></div>
  <input id="msg" placeholder="Message">
  <button onclick="send()">Send</button>
</div>

<script>
let ws;
let user;

async function login() {
  const username = document.getElementById("username").value;
  const res = await fetch("/login", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ username })
  });

  user = await res.json();

  ws = new WebSocket(
    (location.protocol === "https:" ? "wss://" : "ws://") + location.host
  );

  ws.onopen = () => {
    ws.send(JSON.stringify({ type: "auth", userId: user.id }));
    document.getElementById("login").style.display = "none";
    document.getElementById("app").style.display = "block";
  };

  ws.onmessage = (e) => {
    const msg = JSON.parse(e.data);
    if (msg.type === "chat") {
      const div = document.createElement("div");
      div.textContent = `${msg.user}: ${msg.text}`;
      document.getElementById("chat").appendChild(div);
    }
  };
}

function send() {
  const text = document.getElementById("msg").value;
  ws.send(JSON.stringify({ type: "chat", text }));
  document.getElementById("msg").value = "";
}
</script>

</body>
</html>
